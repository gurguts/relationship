<!DOCTYPE html>
<html lang="ua">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Фінансове управління</title>

    <link rel="stylesheet" href="/css/finance.css">
    <link rel="stylesheet" href="/css/common.css">

    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96"/>
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg"/>
    <link rel="shortcut icon" href="/favicon/favicon.ico"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/>
    <meta name="apple-mobile-web-app-title" content="Vinteh"/>
    <link rel="manifest" href="/favicon/site.webmanifest"/>
</head>
<body>
<label class="hamburger">
    <input id="hamburger" type="checkbox">
    <svg viewBox="0 0 32 32">
        <path class="line line-top-bottom"
              d="M27 10 13 10C10.8 10 9 8.2 9 6 9 3.5 10.8 2 13 2 15.2 2 17 3.8 17 6L17 26C17 28.2 18.8 30 21 30 23.2 30 25 28.2 25 26 25 23.8 23.2 22 21 22L7 22"></path>
        <path class="line" d="M7 16 27 16"></path>
    </svg>
</label>

<header>
    <div class="user-info">
        <span id="userName">Не вказано</span><br>
        <span id="userBalance">0</span>
    </div>
    <nav>
        <ul>
            <li id="nav-clients" class="dropdown">
                <a href="#" onclick="return false;">
                    Клієнти
                    <span class="dropdown-arrow">▼</span>
                </a>
                <ul id="client-types-dropdown" class="dropdown-menu" style="display: none;">
                </ul>
            </li>
            <li id="nav-routes" class="dropdown">
                <a href="#" onclick="return false;">
                    Маршрути
                    <span class="dropdown-arrow">▼</span>
                </a>
                <ul id="route-types-dropdown" class="dropdown-menu" style="display: none;">
                </ul>
            </li>
            <li id="nav-purchase" class="dropdown">
                <a href="#" onclick="return false;">
                    Закупівлі
                    <span class="dropdown-arrow">▼</span>
                </a>
                <ul id="purchase-types-dropdown" class="dropdown-menu" style="display: none;">
                </ul>
            </li>
            <li id="nav-containers" class="dropdown">
                <a href="#" onclick="return false;">
                    Тари
                    <span class="dropdown-arrow">▼</span>
                </a>
                <ul id="container-types-dropdown" class="dropdown-menu" style="display: none;">
                </ul>
            </li>
            <li id="nav-inventory"><a href="/inventory">
                Баланс тари
            </a></li>
            <li id="nav-finance"><a class="selected-nav" href="/finance">
                Фінанси
            </a></li>
            <li id="nav-stock"><a href="/stock">
                Склад
            </a></li>
            <li id="nav-declarant"><a href="/declarant">
                Декларант
            </a></li>
            <li id="nav-analytics"><a href="/analytics">
                Аналітика
            </a></li>
            <li id="nav-settings"><a href="/settings" class="setting-icon-block">
                Налаштування
            </a></li>
            <li id="nav-administration"><a href="/administration">
                Адміністрація
            </a></li>
            <li id="nav-profile"><a href="/profile">
                Мій профіль
            </a></li>
            <li>
                <a href="#" id="logout">
                    Вихід
                </a>
            </li>
        </ul>
    </nav>
</header>

<div class="finance-container">
    <div class="finance-header">
        <h1>Фінансове управління</h1>
        <div class="action-buttons">
            <button id="create-transaction-btn" class="btn-primary">Створити транзакцію</button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" data-tab="accounts">Рахунки та філії</button>
        <button class="tab-btn" data-tab="transactions">Транзакції</button>
        <button class="tab-btn" data-tab="exchange-rates">Курси валют</button>
    </div>

    <!-- Accounts Tab -->
    <div id="accounts-tab" class="tab-content active">
        <div id="accounts-branches-container">
            <!-- Content will be generated by JavaScript -->
        </div>
    </div>

    <!-- Transactions Tab -->
    <div id="transactions-tab" class="tab-content">
        <div class="filter-section">
            <label for="transaction-type-filter">Тип:</label>
            <select id="transaction-type-filter">
                <option value="">Всі типи</option>
                <option value="INTERNAL_TRANSFER">Переказ між рахунками</option>
                <option value="EXTERNAL_INCOME">Зовнішній прихід</option>
                <option value="EXTERNAL_EXPENSE">Зовнішня витрата</option>
                <option value="CLIENT_PAYMENT">Оплата клієнту</option>
                <option value="CURRENCY_CONVERSION">Конвертація валют</option>
                <option value="VEHICLE_EXPENSE">Витрати на машину</option>
            </select>
            <label for="transaction-account-filter">Рахунок:</label>
            <select id="transaction-account-filter">
                <option value="">Всі рахунки</option>
            </select>
            <label for="transaction-category-filter">Категорія:</label>
            <select id="transaction-category-filter">
                <option value="">Всі категорії</option>
            </select>
            <label for="transaction-date-from">Дата від:</label>
            <input type="date" id="transaction-date-from">
            <label for="transaction-date-to">Дата до:</label>
            <input type="date" id="transaction-date-to">
            <button id="apply-transaction-filters" class="btn-primary">Застосувати фільтри</button>
            <button id="export-transactions-btn" class="btn-secondary">Експорт в Excel</button>
        </div>
        <div class="table-container">
            <table id="transactions-table" class="data-table">
                <thead>
                <tr>
                    <th>Дата</th>
                    <th>Тип</th>
                    <th>Машина</th>
                    <th>Категорія</th>
                    <th>З рахунку</th>
                    <th>На рахунок</th>
                    <th>Сума</th>
                    <th>Валюта</th>
                    <th>Клієнт</th>
                    <th>Опис</th>
                    <th>Дії</th>
                </tr>
                </thead>
                <tbody id="transactions-body"></tbody>
            </table>
        </div>
        <div class="pagination-container">
            <button id="prev-page-btn" class="btn-secondary" disabled>Попередня</button>
            <span id="page-info">Сторінка 1 з 1</span>
            <button id="next-page-btn" class="btn-secondary" disabled>Наступна</button>
        </div>
    </div>

    <!-- Exchange Rates Tab -->
    <div id="exchange-rates-tab" class="tab-content">
        <div class="info-section" style="margin-bottom: 20px; padding: 15px; background-color: #f0f0f0; border-radius: 5px;">
            <p><strong>Інформація:</strong> Курси валют використовуються для конвертації закупок у EUR. Встановіть курс UAH до EUR та USD до EUR.</p>
        </div>
        <div class="table-container">
            <table id="exchange-rates-table" class="data-table">
                <thead>
                <tr>
                    <th>Валюта</th>
                    <th>Курс до EUR</th>
                    <th>Оновлено</th>
                    <th>Дії</th>
                </tr>
                </thead>
                <tbody id="exchange-rates-body"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Create Transaction Modal -->
<div id="create-transaction-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Створити транзакцію</h2>
        <form id="transaction-form">
            <div class="form-group">
                <label for="transaction-type">Тип транзакції:</label>
                <select id="transaction-type" required>
                    <option value="">Виберіть тип</option>
                    <option value="INTERNAL_TRANSFER">Переказ між рахунками</option>
                    <option value="EXTERNAL_INCOME">Зовнішній прихід</option>
                    <option value="EXTERNAL_EXPENSE">Зовнішня витрата</option>
                    <option value="CLIENT_PAYMENT">Оплата клієнту</option>
                    <option value="CURRENCY_CONVERSION">Конвертація валют</option>
                </select>
            </div>

            <div class="form-group" id="from-account-group">
                <label for="from-account">З рахунку:</label>
                <select id="from-account"></select>
            </div>

            <div class="form-group" id="to-account-group">
                <label for="to-account">На рахунок:</label>
                <select id="to-account"></select>
            </div>

            <div class="form-group" id="conversion-account-group" style="display: none;">
                <label for="conversion-account">Рахунок:</label>
                <select id="conversion-account"></select>
            </div>

            <div class="form-group">
                <label for="transaction-category">Категорія:</label>
                <select id="transaction-category"></select>
            </div>

            <div class="form-group" id="amount-group">
                <label for="transaction-amount" id="transaction-amount-label">Сума:</label>
                <input type="number" id="transaction-amount" step="0.01" min="0.01" required>
            </div>

            <div class="form-group" id="received-amount-group" style="display: none;">
                <label for="transaction-received-amount">Сума зачислення:</label>
                <input type="number" id="transaction-received-amount" step="0.01" min="0.01">
                <small style="display: block; color: #666; margin-top: 5px;">Сума, яка буде зарахована на рахунок отримувача</small>
            </div>

            <div class="form-group" id="commission-display-group" style="display: none;">
                <label>Комісія:</label>
                <div id="transaction-commission-display" style="padding: 8px; background-color: #f5f5f5; border-radius: 4px; font-weight: bold;">0.00</div>
            </div>

            <div class="form-group" id="currency-group">
                <label for="transaction-currency">З валюту:</label>
                <select id="transaction-currency" required></select>
            </div>

            <div class="form-group" id="conversion-currency-group" style="display: none;">
                <label for="conversion-currency">У валюту:</label>
                <select id="conversion-currency"></select>
            </div>

            <div class="form-group" id="conversion-received-amount-group" style="display: none;">
                <label for="conversion-received-amount">Сума зачислення:</label>
                <input type="number" id="conversion-received-amount" step="0.01" min="0.01">
                <small style="display: block; color: #666; margin-top: 5px;">Сума, яка буде зарахована в цільовій валюті</small>
            </div>

            <div class="form-group" id="conversion-exchange-rate-display-group" style="display: none;">
                <label>Курс обміну:</label>
                <div id="conversion-exchange-rate-display" style="padding: 8px; background-color: #f5f5f5; border-radius: 4px; font-weight: bold;">0.000000</div>
            </div>

            <div class="form-group" id="client-group" style="display: none;">
                <label for="transaction-client">Клієнт:</label>
                <div class="client-autocomplete-wrapper">
                    <input type="text" id="transaction-client" class="client-autocomplete-input" placeholder="Почніть вводити назву клієнта..." autocomplete="off">
                    <input type="hidden" id="transaction-client-id">
                    <div id="client-autocomplete-dropdown" class="client-autocomplete-dropdown"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="transaction-description">Опис:</label>
                <textarea id="transaction-description" rows="3"></textarea>
            </div>

            <button type="submit" class="btn-primary">Створити</button>
        </form>
    </div>
</div>

<!-- View Account Balances Modal -->
<div id="view-balances-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="balances-account-name">Баланси рахунку</h2>
        <table class="data-table">
            <thead>
            <tr>
                <th>Валюта</th>
                <th>Сума</th>
            </tr>
            </thead>
            <tbody id="balances-body"></tbody>
        </table>
    </div>
</div>

<!-- Edit Transaction Modal -->
<div id="edit-transaction-modal" class="modal">
    <div class="modal-content">
        <span class="close" id="close-edit-transaction-modal">&times;</span>
        <h2>Редагувати транзакцію</h2>
        <form id="edit-transaction-form">
            <input type="hidden" id="edit-transaction-id">
            
            <div class="form-group">
                <label for="edit-transaction-category">Категорія:</label>
                <select id="edit-transaction-category"></select>
            </div>

            <div class="form-group">
                <label for="edit-transaction-amount">Сума:</label>
                <input type="number" id="edit-transaction-amount" step="0.01" min="0" required>
                <small style="display: block; color: #666; margin-top: 5px;">Якщо встановити 0, транзакція буде видалена, а гроші повернуті</small>
            </div>

            <div class="form-group">
                <label for="edit-transaction-description">Опис:</label>
                <textarea id="edit-transaction-description" rows="3"></textarea>
            </div>

            <div class="form-group" id="edit-exchange-rate-group" style="display: none;">
                <label for="edit-transaction-exchange-rate">Курс конвертації:</label>
                <input type="number" id="edit-transaction-exchange-rate" step="0.0001" min="0.0001">
            </div>

            <div class="form-group" id="edit-commission-group" style="display: none;">
                <label for="edit-transaction-commission">Комісія (опціонально):</label>
                <input type="number" id="edit-transaction-commission" step="0.01" min="0">
                <small style="display: block; color: #666; margin-top: 5px;">Якщо вказано, на рахунок отримувача буде зараховано суму за мінусом комісії</small>
            </div>

            <div class="form-buttons">
                <button type="submit" class="btn-primary">Зберегти</button>
                <button type="button" class="btn-secondary" id="cancel-edit-transaction">Скасувати</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Exchange Rate Modal -->
<div id="edit-exchange-rate-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="exchange-rate-modal-title">Оновити курс валют</h2>
        <form id="exchange-rate-form">
            <input type="hidden" id="exchange-rate-currency">
            <div class="form-group">
                <label for="exchange-rate-value">Курс до EUR:</label>
                <input type="number" id="exchange-rate-value" step="0.000001" min="0.000001" required>
            </div>
            <button type="submit" class="btn-primary" id="exchange-rate-submit-btn">Оновити</button>
        </form>
    </div>
</div>

<script src="/js/common.js"></script>
<script src="/js/finance.js"></script>
</body>
</html>

